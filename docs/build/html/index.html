

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Welcome to prestest’s documentation! &mdash; prestest 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Container" href="container.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home" alt="Documentation Home"> prestest
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html">Fixture Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html#id3">Fixtures</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">prestest</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Welcome to prestest’s documentation!</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="welcome-to-prestest-s-documentation">
<h1>Welcome to prestest’s documentation!<a class="headerlink" href="#welcome-to-prestest-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html">Fixture Parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html#container">container</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html#db-manager">db_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html#start-container">start_container</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html#create-temporary-table">create_temporary_table</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html#id3">Fixtures</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
</div>
</div>
<div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>A Python library providing a testing environment for hive table creation and cleaning through presto connector. It lets
you mock the environment where you need to execute presto query and operate on tables managed by hive.</p>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>The latest version can be install from checking master branch at <a class="reference external" href="https://github.com/staftermath/prestest">github</a> and
install with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>You also need to <a class="reference external" href="https://docs.docker.com/get-docker/">install docker daemon</a>. You may check if it is installed by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker ps
</pre></div>
</div>
<p>This library is heavily dependent on <a class="reference external" href="https://hub.docker.com/r/bde2020/hive/">hive docker</a>. You need to clone hive
docker file repo from <a class="reference external" href="https://github.com/big-data-europe/docker-hive">docker-hive github</a>. In this doc, we will refer
the folder containing cloned repo as <strong>docker folder</strong>. For example, <cite>/tmp/repos/docker-hive</cite>. If prestest’s repos is
cloned recursively, you may find the docker folder under root of this repo.</p>
</div>
<div class="section" id="an-example">
<h1>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h1>
<p>The simplest use case is from the <cite>fixtures</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prestest.fixtures</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># Do not import individually as fixtures have dependency that needs to be imported</span>
</pre></div>
</div>
<p>To use in your test:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.testing</span> <span class="kn">import</span> <span class="n">assert_frame_equal</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">DatabaseError</span>

<span class="n">docker_folder</span> <span class="o">=</span> <span class="s1">&#39;Your docker_folder&#39;</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">prestest</span><span class="p">(</span><span class="n">allow_table_modification</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">container_folder</span><span class="o">=</span><span class="n">docker_folder</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_start_container_enable_table_modification_allow_presto_table_creation_and_drop</span><span class="p">(</span>
        <span class="n">start_container</span><span class="p">,</span> <span class="n">db_manager</span><span class="p">):</span>
    <span class="c1"># create a sample table through presto</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="s2">&quot;sandbox.test_table&quot;</span>
    <span class="n">create_table</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    CREATE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> AS</span>
<span class="s2">    SELECT</span>
<span class="s2">        1 AS col1,</span>
<span class="s2">        &#39;dummy&#39; AS col2</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">db_manager</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">create_table</span><span class="p">)</span>

    <span class="c1"># test that the table is created properly and can be queried from presto</span>
    <span class="n">select_table</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db_manager</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">select_table</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]})</span>
    <span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

    <span class="c1"># test table dropping is permitted</span>
    <span class="n">db_manager</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DROP TABLE </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># test that the table is properly dropped</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DatabaseError</span><span class="p">):</span>
        <span class="n">db_manager</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">select_table</span><span class="p">)</span>
</pre></div>
</div>
<p>Some fixtures can be configured through <code class="code docutils literal notranslate"><span class="pre">&#64;pytext.mark.prestest</span></code>. See <a class="reference internal" href="fixtures.html#fixtures"><span class="std std-ref">Fixture Parameters</span></a> for details.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="container.html" class="btn btn-neutral float-right" title="Container" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Weiwen Gu

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>